(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{704:function(e,a,t){"use strict";t.r(a);var i,n,s,c=t(0),l=t(2),d=t(6),o=t(1),r=t(868),b=t.n(r),u=(t(3),t(8)),f=t(9),m=t(32),h=t(29),p=t(13),g=t(4),v=t.n(g),j=t(15),O=t.n(j),_=t(49),C=t(227),y=t(62),M=t(30),w=t(69),F=t(112),N=t(5),k=t(84),x=Object(u.connect)(function(e){return{displayFqn:Object(k.a)(e)}})(function(e){var a=e.account,t=e.displayFqn;return Object(c.a)("div",{className:"card h-card"},void 0,Object(c.a)("a",{target:"_blank",rel:"noopener",href:a.get("url")},void 0,Object(c.a)("div",{className:"card__img"},void 0,Object(c.a)(w.a,{alt:"",src:a.get("header")})),Object(c.a)("div",{className:"card__bar"},void 0,Object(c.a)("div",{className:"avatar"},void 0,Object(c.a)(w.a,{alt:"",className:"u-photo",src:a.get("avatar"),width:"48",height:"48"})),Object(c.a)("div",{className:"display-name"},void 0,Object(c.a)("span",{style:{display:"none"}},void 0,a.get("username")),Object(c.a)("bdi",{},void 0,Object(c.a)("strong",{className:"emojify p-name"},void 0,a.get("display_name"),a.getIn(["pleroma","tags"],Object(N.List)()).includes("verified")&&Object(c.a)(F.a,{}))),Object(c.a)("span",{},void 0,"@",Object(M.a)(a,t))))))}),S=t(51),L=t(39);t.d(a,"default",function(){return q});var P=Object(f.c)({heading:{id:"column.edit_profile",defaultMessage:"Edit profile"},metaFieldLabel:{id:"edit_profile.fields.meta_fields.label_placeholder",defaultMessage:"Label"},metaFieldContent:{id:"edit_profile.fields.meta_fields.content_placeholder",defaultMessage:"Content"},verified:{id:"edit_profile.fields.verified_display_name",defaultMessage:"Verified users may not update their display name"}}),q=Object(u.connect)(function(e){var a=e.get("me"),t=Object(L.e)(e);return{account:e.getIn(["accounts",a]),maxFields:e.getIn(["instance","pleroma","metadata","fields_limits","max_fields"],4),verifiedCanEditName:t.get("verifiedCanEditName")}})(i=Object(m.c)((s=n=function(a){function e(i){var s=a.call(this,i)||this;Object(o.a)(Object(l.a)(s),"state",{isLoading:!1}),Object(o.a)(Object(l.a)(s),"makePreviewAccount",function(){return s.props.account.merge(Object(N.Map)({header:s.state.header,avatar:s.state.avatar,display_name:s.state.display_name}))}),Object(o.a)(Object(l.a)(s),"getFieldParams",function(){var t=Object(N.Map)();return s.state.fields.forEach(function(e,a){return t=t.set("fields_attributes["+a+"][name]",e.get("name")).set("fields_attributes["+a+"][value]",e.get("value"))}),t}),Object(o.a)(Object(l.a)(s),"getParams",function(){var e=Object(l.a)(s).state;return Object.assign({discoverable:e.discoverable,bot:e.bot,display_name:e.display_name,note:e.note,avatar:e.avatar_file,header:e.header_file,locked:e.locked},s.getFieldParams().toJS())}),Object(o.a)(Object(l.a)(s),"getFormdata",function(){var e,a=s.getParams(),t=new FormData;for(e in a){Boolean(void 0!==a[e]||e.startsWith("fields_attributes"))&&t.append(e,a[e]||"")}return t}),Object(o.a)(Object(l.a)(s),"handleSubmit",function(e){var a=s.props.dispatch;a(Object(S.g)(s.getFormdata())).then(function(){s.setState({isLoading:!1}),a(_.a.success("Profile saved!"))}).catch(function(e){s.setState({isLoading:!1})}),s.setState({isLoading:!0}),e.preventDefault()}),Object(o.a)(Object(l.a)(s),"handleCheckboxChange",function(e){var a;s.setState(((a={})[e.target.name]=e.target.checked,a))}),Object(o.a)(Object(l.a)(s),"handleTextChange",function(e){var a;s.setState(((a={})[e.target.name]=e.target.value,a))}),Object(o.a)(Object(l.a)(s),"handleFieldChange",function(a,t){return function(e){s.setState({fields:s.state.fields.setIn([a,t],e.target.value)})}}),Object(o.a)(Object(l.a)(s),"handleFileChange",function(e){var a,t=e.target.name,i=(e.target.files||[])[0],n=i?URL.createObjectURL(i):s.state[t];s.setState(((a={})[t]=n,a[t+"_file"]=i,a))});var e=i.account.withMutations(function(e){var a,t;e.merge(e.get("source")),e.delete("source"),e.set("fields",(a=e.get("fields"),t=i.maxFields,Object(N.List)(a).setSize(t).map(function(e){return e||Object(N.Map)({name:"",value:""})}))),["display_name","bio"].reduce(function(e,a){return e.set(a,b()(e.get(a)))},e)});return s.state=e.toObject(),s}return Object(d.a)(e,a),e.prototype.render=function(){var t=this,e=this.props,i=e.intl,a=e.maxFields,n=e.account,s=e.verifiedCanEditName,l=Object(M.h)(n),d=s||!l;return Object(c.a)(C.a,{icon:"user",heading:i.formatMessage(P.heading),backBtnSlim:!0},void 0,Object(c.a)(y.i,{onSubmit:this.handleSubmit},void 0,Object(c.a)("fieldset",{disabled:this.state.isLoading},void 0,Object(c.a)(y.b,{},void 0,Object(c.a)(y.l,{className:d?"":"disabled",label:Object(c.a)(h.a,{id:"edit_profile.fields.display_name_label",defaultMessage:"Display name"}),name:"display_name",value:this.state.display_name,onChange:this.handleTextChange,disabled:!d,hint:!d&&i.formatMessage(P.verified)}),Object(c.a)(y.k,{label:Object(c.a)(h.a,{id:"edit_profile.fields.bio_label",defaultMessage:"Bio"}),name:"note",autoComplete:"off",value:this.state.note,wrap:"hard",onChange:this.handleTextChange,rows:3}),Object(c.a)("div",{className:"fields-row"},void 0,Object(c.a)("div",{className:"fields-row__column fields-row__column-6"},void 0,Object(c.a)(x,{account:this.makePreviewAccount()})),Object(c.a)("div",{className:"fields-row__column fields-group fields-row__column-6"},void 0,Object(c.a)(y.c,{label:Object(c.a)(h.a,{id:"edit_profile.fields.header_label",defaultMessage:"Header"}),name:"header",hint:Object(c.a)(h.a,{id:"edit_profile.hints.header",defaultMessage:"PNG, GIF or JPG. At most 2 MB. Will be downscaled to 1500x500px"}),onChange:this.handleFileChange}),Object(c.a)(y.c,{label:Object(c.a)(h.a,{id:"edit_profile.fields.avatar_label",defaultMessage:"Avatar"}),name:"avatar",hint:Object(c.a)(h.a,{id:"edit_profile.hints.avatar",defaultMessage:"PNG, GIF or JPG. At most 2 MB. Will be downscaled to 400x400px"}),onChange:this.handleFileChange}))),Object(c.a)(y.a,{label:Object(c.a)(h.a,{id:"edit_profile.fields.locked_label",defaultMessage:"Lock account"}),hint:Object(c.a)(h.a,{id:"edit_profile.hints.locked",defaultMessage:"Requires you to manually approve followers"}),name:"locked",checked:this.state.locked,onChange:this.handleCheckboxChange}),Object(c.a)(y.a,{label:Object(c.a)(h.a,{id:"edit_profile.fields.bot_label",defaultMessage:"This is a bot account"}),hint:Object(c.a)(h.a,{id:"edit_profile.hints.bot",defaultMessage:"This account mainly performs automated actions and might not be monitored"}),name:"bot",checked:this.state.bot,onChange:this.handleCheckboxChange})),Object(c.a)(y.b,{},void 0,Object(c.a)("div",{className:"fields-row__column fields-group"},void 0,Object(c.a)("div",{className:"input with_block_label"},void 0,Object(c.a)("label",{},void 0,Object(c.a)(h.a,{id:"edit_profile.fields.meta_fields_label",defaultMessage:"Profile metadata"})),Object(c.a)("span",{className:"hint"},void 0,Object(c.a)(h.a,{id:"edit_profile.hints.meta_fields",defaultMessage:"You can have up to {count, plural, one {# item} other {# items}} displayed as a table on your profile",values:{count:a}})),this.state.fields.map(function(e,a){return Object(c.a)("div",{className:"row"},a,Object(c.a)(y.l,{placeholder:i.formatMessage(P.metaFieldLabel),value:e.get("name"),onChange:t.handleFieldChange(a,"name")}),Object(c.a)(y.l,{placeholder:i.formatMessage(P.metaFieldContent),value:e.get("value"),onChange:t.handleFieldChange(a,"value")}))}))))),Object(c.a)("div",{className:"actions"},void 0,Object(c.a)("button",{name:"button",type:"submit",className:"btn button button-primary"},void 0,Object(c.a)(h.a,{id:"edit_profile.save",defaultMessage:"Save"})))))},e}(p.a),Object(o.a)(n,"propTypes",{dispatch:v.a.func.isRequired,intl:v.a.object.isRequired,account:O.a.map,maxFields:v.a.number,verifiedCanEditName:v.a.bool}),i=s))||i)||i},868:function(e,a,t){var i=t(236),n=t(869),s=/&(?:amp|lt|gt|quot|#39);/g,l=RegExp(s.source);e.exports=function(e){return(e=i(e))&&l.test(e)?e.replace(s,n):e}},869:function(e,a,t){var i=t(357)({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"});e.exports=i}}]);
//# sourceMappingURL=edit_profile-e547566b2461e3ec6b07.chunk.js.map